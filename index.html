<!doctype html>
<html>
	<head>
		<title>Pitch Detector</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link href='https://fonts.googleapis.com/css?family=Alike' rel='stylesheet' type='text/css'>
		<style>
			* {
				box-sizing: border-box;
			}

			html, body {
				height: 100%;
				margin: 0;
			}

			body {
				font: 14pt 'Alike', sans-serif;
				padding: 20px;
				background-color: #f5f5f5;
				display: flex;
				flex-direction: column;
			}

			.container {
				flex: 1;
				display: flex;
				flex-direction: column;
				max-width: 1200px;
				width: 100%;
				margin: 0 auto;
			}

			h1 {
				text-align: center;
				color: #333;
				margin: 0 0 15px 0;
				font-size: 1.8rem;
				flex-shrink: 0;
			}

			.controls {
				display: flex;
				flex-wrap: wrap;
				gap: 15px;
				justify-content: center;
				align-items: center;
				margin-bottom: 15px;
				flex-shrink: 0;
			}

			#stopButton {
				padding: 12px 32px;
				font-size: 16px;
				font-family: 'Alike', sans-serif;
				background-color: #e74c3c;
				color: white;
				border: none;
				border-radius: 6px;
				cursor: pointer;
				transition: background-color 0.2s;
				display: none;
			}

			#stopButton:hover {
				background-color: #c0392b;
			}

			#stopButton:active {
				background-color: #a93226;
			}

			#instrument {
				padding: 12px 16px;
				font-size: 16px;
				font-family: 'Alike', sans-serif;
				border: 2px solid #ddd;
				border-radius: 6px;
				background-color: white;
				cursor: pointer;
			}

			#instrument:focus {
				outline: none;
				border-color: #4CAF50;
			}

			.tuning-toggle-container {
				display: flex;
				align-items: center;
				gap: 10px;
				font-size: 16px;
			}

			.toggle-switch {
				position: relative;
				display: inline-block;
				width: 50px;
				height: 26px;
			}

			.toggle-switch input {
				opacity: 0;
				width: 0;
				height: 0;
			}

			.toggle-slider {
				position: absolute;
				cursor: pointer;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				background-color: #ccc;
				transition: 0.3s;
				border-radius: 26px;
			}

			.toggle-slider:before {
				position: absolute;
				content: "";
				height: 18px;
				width: 18px;
				left: 4px;
				bottom: 4px;
				background-color: white;
				transition: 0.3s;
				border-radius: 50%;
			}

			input:checked + .toggle-slider {
				background-color: #4CAF50;
			}

			input:checked + .toggle-slider:before {
				transform: translateX(24px);
			}

			.main-display {
				flex: 1;
				display: flex;
				gap: 20px;
				min-height: 0;
			}

			#detector {
				flex: 1;
				background-color: white;
				border: 4px solid #ddd;
				border-radius: 12px;
				text-align: center;
				padding: 20px;
				box-shadow: 0 2px 10px rgba(0,0,0,0.1);
				display: flex;
				flex-direction: column;
				justify-content: center;
				align-items: center;
				min-width: 0;
				transition: background-color 0.2s ease;
			}

			#detector.confident {
				border-color: #4CAF50;
			}

			#detector.vague {
				border-color: #ddd;
			}

			/* Background colors now applied dynamically via JavaScript */
			#detector.flat {
				/* background-color set dynamically */
			}

			#detector.sharp {
				/* background-color set dynamically */
			}

			div.confident {
				color: black;
			}

			div.vague {
				color: #ccc;
			}

			.pitch {
				font-size: 18px;
				color: #666;
				margin-bottom: 10px;
			}

			#pitch {
				font-size: clamp(20px, 3vw, 28px);
				font-weight: bold;
				color: #333;
			}

			#note {
				font-size: clamp(60px, 15vw, 140px);
				line-height: 1.1;
				display: block;
				margin: 10px 0;
			}

			#detune {
				font-size: clamp(14px, 2vw, 18px);
				color: #666;
				min-height: 30px;
			}

			#detune_amt {
				font-weight: bold;
				color: #333;
			}

			#flat, #sharp {
				display: none;
			}

			.flat #flat {
				display: inline;
				color: #e74c3c;
			}

			.sharp #sharp {
				display: inline;
				color: #3498db;
			}

			.canvas-container {
				flex: 1;
				background-color: white;
				border-radius: 12px;
				padding: 10px;
				box-shadow: 0 2px 10px rgba(0,0,0,0.1);
				display: flex;
				align-items: center;
				justify-content: center;
				min-width: 0;
				overflow: hidden;
			}

			#vexflow-output {
				width: 100%;
				height: 100%;
				display: flex;
				align-items: center;
				justify-content: center;
			}

			#vexflow-output svg {
				display: block;
				max-width: 100%;
				max-height: 100%;
			}

			.droptarget {
				background-color: #348781;
			}

			.github-link {
				position: fixed;
				top: 0;
				right: 0;
				z-index: 100;
			}

			.github-link img {
				width: 100px;
				height: auto;
			}

			/* Mobile styles */
			@media (max-width: 700px) {
				body {
					padding: 10px;
				}

				h1 {
					font-size: 1.4rem;
					margin-bottom: 10px;
				}

				.controls {
					flex-direction: column;
					gap: 10px;
					margin-bottom: 10px;
				}

				#stopButton,
				#instrument {
					width: 100%;
					max-width: 280px;
				}

				.tuning-toggle-container {
					width: 100%;
					max-width: 280px;
					justify-content: center;
				}

				.main-display {
					flex-direction: column;
				}

				#detector {
					flex: none;
					min-height: 180px;
				}

				.canvas-container {
					flex: 1;
					min-height: 150px;
				}

				.github-link {
					display: none;
				}
			}
		</style>
	</head>
	<body>
		<script src="https://unpkg.com/vexflow@3.0.9/releases/vexflow-min.js"></script>
		<script src="js/pitchdetect.js"></script>

		<div class="container">
			<h1>Pitch Detector</h1>
			<div class="nav-links" style="text-align: center; margin-bottom: 15px;">
				<a href="note-trainer.html" style="color: #4CAF50; text-decoration: none; font-size: 14px;">Go to Note Trainer</a>
			</div>

			<div class="controls">
				<select name="Instrument" id="instrument">
					<option value="">Select an instrument to begin</option>
					<option value="treble clef">Treble Clef</option>
					<option value="bass clef">Bass Clef</option>
					<option value="flute">Flute</option>
					<option value="oboe">Oboe</option>
					<option value="clarinet">Clarinet</option>
					<option value="bass clarinet">Bass Clarinet</option>
					<option value="bassoon">Bassoon</option>
					<option value="alto sax">Alto Sax</option>
					<option value="tenor sax">Tenor Sax</option>
					<option value="bari sax">Bari Sax</option>
					<option value="trumpet">Trumpet</option>
					<option value="horn">Horn</option>
					<option value="trombone">Trombone</option>
					<option value="euphonium">Euphonium</option>
					<option value="tuba">Tuba</option>
					<option value="glockenspiel">Glockenspiel</option>
				</select>
				<div class="tuning-toggle-container">
					<label for="tuningToggle">Color Tuner:</label>
					<label class="toggle-switch">
						<input type="checkbox" id="tuningToggle" checked>
						<span class="toggle-slider"></span>
					</label>
				</div>
				<button id="stopButton" onclick="stopPitchDetect();">Stop</button>
			</div>

			<div class="main-display">
				<div id="detector" class="vague">
					<div class="pitch"><span id="pitch">--</span> Hz</div>
					<span id="note">--</span>
					<div id="detune">
						<span id="detune_amt">--</span>
						<span id="flat">cents &#9837;</span>
						<span id="sharp">cents &#9839;</span>
					</div>
				</div>

				<div class="canvas-container">
					<div id="vexflow-output"></div>
				</div>
			</div>
		</div>

		<a href="https://github.com/cwilso/pitchdetect" class="github-link">
			<img src="img/forkme.png" alt="Fork me on GitHub">
		</a>
	</body>
</html>
